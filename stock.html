<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" href="/images/favico.png" type="image/x-icon">
  <title>Stocks & ETFs — InvestHub</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link rel="stylesheet" href="/css/style.css">

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

  <!-- GSAP -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>

  <!-- TradingView Widget -->
  <script src="https://s3.tradingview.com/tv.js"></script>

  <style>
    :root {
      /* Dark & Gold Color Palette */
      --dark-primary: #000207;
      --dark-secondary: #1a1f2e;
      --dark-tertiary: #2d3345;
      --gold-primary: #ecc906dc;
      --gold-secondary: #bfac03e8;
      --gold-dark: #b59b04d8;
      --gold-gradient: linear-gradient(135deg, #ffd900a4 0%, #ae9f18 100%);
      --dark-gradient: linear-gradient(135deg, #0a0f1c 0%, #1a1f2e 100%);
      
      /* Text Colors */
      --text-light: #f8f9fa;
      --text-muted: #a0aec0;
      --text-dark: #2d3748;
      
      /* Component Colors */
      --card-bg: #1a1f2e;
      --section-bg: #0a0f1c;
      --border-color: #2d3345;
      
      /* Status Colors */
      --success: #48bb78;
      --danger: #f56565;
      --warning: #ed8936;
      --info: #4299e1;
      
      /* Button Colors */
      --btn-primary-bg: var(--gold-primary);
      --btn-primary-text: var(--dark-primary);
      --btn-primary-hover: var(--gold-secondary);
      
      --btn-secondary-bg: transparent;
      --btn-secondary-text: var(--gold-primary);
      --btn-secondary-border: var(--gold-primary);
      --btn-secondary-hover: rgba(255, 215, 0, 0.1);
    }

    [data-theme="light"] {
      --dark-primary: #f7f9fc;
      --dark-secondary: #ffffff;
      --dark-tertiary: #f1f5f9;
      --gold-primary: #a56b00;
      --text-light: #0b1220;
      --text-muted: #52607a;
      --border-color: #e6edf5;
    }

    html, body {
      height: 100%;
      background: var(--dark-primary);
      color: var(--text-light);
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }

    .container { 
      max-width: 1200px; 
      margin-left: auto; 
      margin-right: auto; 
    }

    .glow {
      color: var(--gold-primary);
      text-shadow: 0 0 12px rgba(236,201,6,0.25);
    }

    .card {
      background: linear-gradient(180deg, var(--dark-secondary), rgba(0,0,0,0.02));
      border: 1px solid var(--border-color);
      border-radius: 14px;
      padding: 18px;
      margin-bottom: 1rem;
    }

    .btn-gold {
      background: var(--gold-gradient);
      color: var(--dark-primary);
      border-radius: 999px;
      padding: 10px 18px;
      font-weight: 700;
      box-shadow: 0 6px 20px rgba(236,201,6,0.08);
      border: none;
      transition: all 0.3s ease;
    }

    .btn-gold:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(236,201,6,0.15);
      background: var(--gold-secondary);
    }

    .btn-ghost {
      background: transparent;
      border: 1px solid var(--border-color);
      color: var(--text-light);
      padding: 8px 14px;
      border-radius: 999px;
      transition: all 0.3s ease;
    }

    .btn-ghost:hover {
      background: rgba(255,255,255,0.05);
      transform: translateY(-1px);
    }

    .ticker {
      background: var(--dark-tertiary);
      border-top: 1px solid var(--border-color);
      border-bottom: 1px solid var(--border-color);
      overflow: hidden;
      white-space: nowrap;
      padding: 8px 0;
      margin-top: 18px;
    }

    .ticker-track {
      display: inline-flex;
      gap: 48px;
      padding-left: 100%;
      animation: tickerScroll 28s linear infinite;
      align-items: center;
    }

    .ticker-item {
      color: var(--gold-primary);
      font-weight: 700;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-size: 0.95rem;
    }

    @keyframes tickerScroll {
      0% { transform: translateX(0); }
      100% { transform: translateX(-100%); }
    }

    .hero {
      position: relative;
      overflow: hidden;
      padding: 100px 12px 56px;
    }

    .hero-bg {
      position: absolute;
      inset: 0;
      background:
        radial-gradient( circle at 10% 80%, rgba(236,201,6,0.06), transparent 12%),
        radial-gradient( circle at 85% 10%, rgba(0,163,255,0.04), transparent 12% );
      z-index: 0;
      transform-origin: center;
    }

    .hero-inner { 
      position: relative; 
      z-index: 10; 
    }

    .stock-card {
      border-radius: 12px;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border: 1px solid rgba(255,255,255,0.03);
      padding: 16px;
      transition: transform 0.25s ease, box-shadow 0.25s ease;
      cursor: pointer;
      height: 100%;
    }
    
    .stock-card:hover {
      transform: translateY(-6px);
      box-shadow: 0 12px 40px rgba(0,0,0,0.35);
    }

    .stock-logo {
      width: 52px; 
      height: 52px; 
      border-radius: 10px;
      display:flex; 
      align-items:center; 
      justify-content:center;
      font-weight:800; 
      color: var(--dark-primary); 
      background: var(--gold-gradient);
    }

    .stock-price { 
      font-size: 1.6rem; 
      font-weight:800; 
      color: var(--text-light); 
    }
    
    .stock-change-up { 
      color: var(--success); 
    }
    
    .stock-change-down { 
      color: var(--danger); 
    }

    .etf-card, .tool-card { 
      border-radius: 14px; 
      padding: 22px; 
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); 
      border:1px solid rgba(255,255,255,0.03); 
      height: 100%;
    }

    .trading-view { 
      border-radius: 12px; 
      overflow: hidden; 
      border: 1px solid var(--border-color); 
      background: linear-gradient(180deg, var(--dark-secondary), rgba(0,0,0,0.02)); 
    }

    /* modal */
    .modal-bg { 
      position: fixed; 
      inset: 0; 
      background: rgba(2,6,23,0.6); 
      display:flex; 
      align-items:center; 
      justify-content:center; 
      z-index:60; 
    }
    
    .modal { 
      width: 100%; 
      max-width: 560px; 
      border-radius: 12px; 
      padding: 18px; 
      background: linear-gradient(180deg, var(--dark-secondary), rgba(0,0,0,0.02)); 
      border: 1px solid var(--border-color); 
    }

    /* small helpers */
    .muted { 
      color: var(--text-muted); 
      font-size: 0.95rem; 
    }
    
    .small { 
      font-size: 0.85rem; 
      color: var(--text-muted); 
    }


    /* Responsive adjustments */
    @media (max-width: 768px) {
      .hero { 
        padding: 80px 12px 36px; 
      }
      
      .stock-price { 
        font-size: 1.25rem; 
      }
    }

  </style>
</head>
<body data-theme="dark">

  <!-- PAGE WRAPPER -->
  <div class="min-vh-100">

    <!-- Bootstrap Navbar -->
       <nav class="navbar navbar-expand-lg navbar-trade fixed-top mb-0">
    <div class="container">
        <a class="navbar-brand" href="#">
            InvestHub
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavDropdown"
            aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNavDropdown">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                <li class="nav-item">
                    <a class="nav-link active" aria-current="page" href="/index.html">Home</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/invest.html">Invest</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/cashcard.html">Cash Card</a>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown"
                        aria-expanded="false">
                        What We Offer
                    </a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="/invest.html">Invest</a></li>
                        <li><a class="dropdown-item" href="#">Trading</a></li>
                        <li><a class="dropdown-item" href="#">Banking</a></li>
                        <li><a class="dropdown-item" href="/stock.html">Stocks & ETFs</a></li>
                        <li><a class="dropdown-item" href="#">Options</a></li>
                        <li><a class="dropdown-item" href="#">Crypto</a></li>
                    </ul>
                </li>
                 <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown"
                        aria-expanded="false">
                      Others
                    </a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="/testimonial.html">Testimonials</a></li>
                        <li><a class="dropdown-item" href="/faq.html">FAQ</a></li>
                    </ul>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/learn.html">Learn</a>
                </li>
            </ul>
            <div class="d-flex btn-container">
                <button class="btn btn-login me-2 "><a href="/login.html" class="log">Log in</a></button>
                <button class="btn btn-signup"><a href="./signup.html" class="sign">Sign up</a></button>
            </div>
        </div>
    </div>
</nav>

    <!-- HERO -->
    <section class="hero">
      <div class="hero-bg"></div>
      <div class="container hero-inner">
        <div class="row align-items-center">
          <div class="col-md-8">
            <div class="d-inline-block px-4 py-2 rounded-pill btn-gold small mb-3">Advanced Trading Platform</div>
            <h1 class="mt-3 display-4 fw-bold glow">Stocks & ETFs — InvestHub</h1>
            <p class="mt-3 lead muted">Real-time charts, curated ETFs, and pro trading tools. Add symbols to your watchlist, buy/sell in a simulated modal, and switch charts with the TradingView selector.</p>
            <div class="mt-4 d-flex gap-3">
              <button id="startTradeBtn" class="btn-gold">Get Started</button>
              <button id="demoBtn" class="btn-ghost">Schedule Demo</button>
            </div>
          </div>
          <div class="col-md-4 mt-4 mt-md-0">
            <div class="card">
              <div class="d-flex justify-content-between align-items-start">
                <div>
                  <div class="muted">Portfolio Value</div>
                  <div class="h2 fw-bold">$<span id="portfolioValue">12,340</span></div>
                  <div class="small mt-1">Unrealized P/L <span class="stock-change-up">+2.1%</span></div>
                </div>
                <div class="text-end">
                  <div class="small muted">Welcome back</div>
                  <div class="fw-semibold">Trader</div>
                  <button id="themeToggle" class="mt-3 btn-ghost small"><i class="fa fa-moon"></i> Toggle Theme</button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- small performance summary -->
        <div class="row mt-5">
          <div class="col-md-4 mb-3">
            <div class="card d-flex flex-row justify-content-between align-items-center p-4">
              <div>
                <div class="small muted">Global Market Cap</div>
                <div class="h4 fw-bold">$<span id="globalCap">43,200,000,000,000</span></div>
              </div>
              <div class="text-end">
                <div class="small muted">24h Volume</div>
                <div class="fw-bold">$<span id="vol">298,000,000,000</span></div>
              </div>
            </div>
          </div>
          <div class="col-md-4 mb-3">
            <div class="card p-4">
              <div class="small muted">Top Movers</div>
              <div class="mt-2">
                <div class="mb-1"><span class="fw-semibold">NVDA</span> <span class="stock-change-up">+4.2%</span></div>
                <div><span class="fw-semibold">TSLA</span> <span class="stock-change-up">+3.8%</span></div>
              </div>
            </div>
          </div>
          <div class="col-md-4 mb-3">
            <div class="card p-4">
              <div class="small muted">Active ETFs</div>
              <div class="mt-2 h4 fw-bold">1,470</div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- TICKER -->
    <div class="ticker">
      <div class="container">
        <div class="ticker-track" id="tickerTrack">
          <!-- items will be inserted by JS -->
        </div>
      </div>
    </div>

    <!-- MAIN CONTENT -->
    <main class="container px-3 px-md-0 py-5">

      <!-- Market Performance Chart + selector -->
      <section class="mb-5">
        <div class="row">
          <div class="col-lg-9 mb-4 mb-lg-0">
            <div class="card p-4">
              <div class="d-flex justify-content-between align-items-center mb-4">
                <h3 class="fw-bold glow">Market Performance</h3>
                <div class="d-flex align-items-center gap-3">
                  <select id="perfSelector" class="form-select form-select-sm bg-transparent border border-secondary text-light" style="max-width: 150px;">
                    <option value="stocks">Top Stocks</option>
                    <option value="etfs">Top ETFs</option>
                  </select>
                  <button id="refreshPerf" class="btn-ghost small"><i class="fa fa-sync"></i> Refresh</button>
                </div>
              </div>
              <canvas id="perfChart" height="120"></canvas>
            </div>
          </div>
          <div class="col-lg-3">
            <div class="card p-4 h-100">
              <div class="d-flex justify-content-between align-items-center mb-3">
                <h4 class="fw-semibold">Watchlist</h4>
                <button id="clearWatch" class="btn-ghost small">Clear</button>
              </div>
              <div class="mb-3">
                <input id="addSymbolInput" type="text" placeholder="Add symbol (e.g. AAPL)" class="form-control bg-transparent border-secondary text-light" />
                <div class="d-grid mt-3">
                  <button id="addSymbolBtn" class="btn-gold small">Add</button>
                </div>
              </div>
              <div id="watchlistContainer" class="d-flex flex-column gap-2" style="max-height: 300px; overflow-y: auto;">
                <!-- watchlist items come here -->
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Stocks grid -->
      <section id="stocksSection" class="mb-5">
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h2 class="h1 fw-bold glow">Featured Stocks</h2>
          <div class="muted small">Select a card to open buy/sell modal</div>
        </div>
        <div class="row" id="stocksGrid">
          <!-- cards: will be filled by JS so we can maintain data easily -->
        </div>
      </section>

      <!-- ETFs -->
      <section id="etfsSection" class="mb-5">
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h2 class="h1 fw-bold glow">Smart ETFs</h2>
          <div class="muted small">Diversify with these curated ETFs</div>
        </div>
        <div class="row" id="etfsGrid">
          <!-- ETF cards added by JS -->
        </div>
      </section>

      <!-- TradingView interactive widget -->
      <section class="mb-5">
        <h2 class="h1 fw-bold glow mb-4">Live Trading View</h2>
        <div class="trading-view">
          <div class="trading-header d-flex justify-content-between align-items-center p-4 border-bottom" style="border-color:var(--border-color)">
            <div class="d-flex align-items-center gap-3">
              <div class="h4 fw-bold" id="tvCurrentSymbol">AAPL</div>
              <div class="small muted" id="tvSymbolChange">+1.2%</div>
            </div>
            <div class="d-flex align-items-center gap-3">
              <select id="tvInterval" class="form-select form-select-sm bg-transparent border-secondary text-light">
                <option value="1">1</option>
                <option value="5">5</option>
                <option value="15">15</option>
                <option value="60">60</option>
                <option value="D" selected>D</option>
              </select>
              <button id="openSymbolSearch" class="btn-ghost small"><i class="fa fa-search"></i> Search Symbol</button>
            </div>
          </div>
          <div id="tvWidget" class="p-0" style="height:520px;">
            <!-- TradingView widget will be injected here -->
          </div>
        </div>
      </section>

      <!-- Tools -->
      <section class="mb-5">
        <h2 class="h1 fw-bold glow mb-4">Trading Tools</h2>
        <div class="row">
          <div class="col-md-6 col-lg-3 mb-4">
            <div class="tool-card text-center">
              <div class="display-6 mb-3"><i class="fa fa-chart-candlestick"></i></div>
              <h4 class="fw-semibold">Advanced Charts</h4>
              <p class="small muted mt-2">50+ indicators, multi-timeframe, drawing tools.</p>
            </div>
          </div>
          <div class="col-md-6 col-lg-3 mb-4">
            <div class="tool-card text-center">
              <div class="display-6 mb-3"><i class="fa fa-robot"></i></div>
              <h4 class="fw-semibold">AI Signals</h4>
              <p class="small muted mt-2">AI-backed trade ideas & sentiment analysis.</p>
            </div>
          </div>
          <div class="col-md-6 col-lg-3 mb-4">
            <div class="tool-card text-center">
              <div class="display-6 mb-3"><i class="fa fa-bell"></i></div>
              <h4 class="fw-semibold">Smart Alerts</h4>
              <p class="small muted mt-2">Price, volume, and pattern alerts delivered instantly.</p>
            </div>
          </div>
          <div class="col-md-6 col-lg-3 mb-4">
            <div class="tool-card text-center">
              <div class="display-6 mb-3"><i class="fa fa-shield-alt"></i></div>
              <h4 class="fw-semibold">Risk Tools</h4>
              <p class="small muted mt-2">Portfolio risk metrics and auto-stop-loss options.</p>
            </div>
          </div>
        </div>
      </section>

      <!-- CTA -->
      <section class="mb-5">
        <div class="card p-5 text-center">
          <h3 class="h1 fw-bold glow">Ready to trade smarter?</h3>
          <p class="muted mt-2 lead">Create an account and start trading with professional tools and zero commission in our simulated demo.</p>
          <div class="mt-4 d-flex justify-content-center gap-3 flex-wrap">
            <button class="btn-gold" id="ctaCreate">Create Free Account</button>
            <button class="btn-ghost" id="ctaDemo">Request Demo</button>
          </div>
        </div>
      </section>
    </main>

    <!-- Footer Ticker (small) -->
    <div class="ticker mt-auto">
      <div class="container">
        <div class="ticker-track" id="tickerTrackBottom"></div>
      </div>
    </div>
  </div>

  <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h2 class="footer-brand mb-15"><a href="#" class="foot">InvestHub</a></h2>
                    <p class="firstp">We are a leading trading platform providing access to global markets, advanced
                        trading tools, and educational resources for traders of all experience levels.</p>
                    <div class="social-links">
                        <a href="#"><i class="fab fa-facebook-f"></i></a>
                        <a href="#"><i class="fab fa-twitter"></i></a>
                        <a href="#"><i class="fab fa-linkedin-in"></i></a>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                        <a href="#"><i class="fab fa-youtube"></i></a>
                    </div>
                </div>

                <div class="footer-section">
                    <h3>Quick Links</h3>
                    <ul class="footer-links">
                        <li><a href="#"><i class="fas fa-chevron-right"></i> Trading Platforms</a></li>
                        <li><a href="#"><i class="fas fa-chevron-right"></i> Market Analysis</a></li>
                        <li><a href="#"><i class="fas fa-chevron-right"></i> Investment Products</a></li>
                        <li><a href="#"><i class="fas fa-chevron-right"></i> Trading Education</a></li>
                        <li><a href="#"><i class="fas fa-chevron-right"></i> Economic Calendar</a></li>
                    </ul>
                </div>

                <div class="footer-section">
                    <h3>Contact Us</h3>
                    <ul class="contact-info">
                        <li>
                            <i class="fas fa-map-marker-alt"></i>
                            <div>
                                <strong>Headquarters</strong><br>
                                123 Financial District,<br>
                                New York, NY 10005
                            </div>
                        </li>
                        <li>
                            <i class="fas fa-phone"></i>
                            <div>
                                <strong>Phone</strong><br>
                                +1 (555) 123-4567
                            </div>
                        </li>
                        <li>
                            <i class="fas fa-envelope"></i>
                            <div>
                                <strong>Email</strong><br>
                                support@globaltradepro.com
                            </div>
                        </li>
                    </ul>
                </div>

                <div class="footer-section">
                    <h3>Newsletter</h3>
                    <p>Subscribe to our newsletter for market insights, trading tips, and platform updates.</p>
                    <form class="newsletter-form">
                        <input type="email" placeholder="Your email address" required>
                        <button type="submit">Subscribe</button>
                    </form>
                </div>
            </div>
        </div>

        <div class="footer-bottom">
            <div class="container">
                <div class="footer-bottom-content">
                    <p>&copy; 2023 Global Trade Pro. All rights reserved.</p>

                    <div class="payment-methods">
                        <i class="fab fa-cc-visa"></i>
                        <i class="fab fa-cc-mastercard"></i>
                        <i class="fab fa-cc-paypal"></i>
                        <i class="fab fa-cc-apple-pay"></i>
                    </div>

                    <div class="legal-links">
                        <a href="#">Privacy Policy</a>
                        <a href="#">Terms of Service</a>
                        <a href="#">Risk Disclosure</a>
                    </div>
                </div>
            </div>
        </div>
    </footer>

  <!-- MODALS (hidden by default) -->
  <div id="modalRoot" style="display:none;"></div>

  <script>
  /************************************************************************
   * Client-side data & initialization (no backend)
   ************************************************************************/

  // --- Default data (can be replaced with real API data later) ---
  const initialStocks = [
    { symbol: 'AAPL', name: 'Apple Inc.', exchange: 'NASDAQ', price: 178.72 },
    { symbol: 'TSLA', name: 'Tesla Inc.', exchange: 'NASDAQ', price: 245.18 },
    { symbol: 'MSFT', name: 'Microsoft Corp.', exchange: 'NASDAQ', price: 374.51 },
    { symbol: 'NVDA', name: 'NVIDIA Corp.', exchange: 'NASDAQ', price: 473.20 },
    { symbol: 'AMZN', name: 'Amazon.com Inc.', exchange: 'NASDAQ', price: 132.14 },
    { symbol: 'GOOGL', name: 'Alphabet Inc.', exchange: 'NASDAQ', price: 132.75 }
  ];

  const initialETFs = [
    { ticker: 'SPY', title:'SPDR S&P 500 ETF', expense:'0.09%', aum:'$452B', ytd:'+12.5%' },
    { ticker: 'QQQ', title:'Invesco QQQ Trust', expense:'0.20%', aum:'$200B', ytd:'+14.2%' },
    { ticker: 'VTI', title:'Vanguard Total Stock Market', expense:'0.03%', aum:'$350B', ytd:'+11.0%' }
  ];

  // --- watchlist persisted in localStorage ---
  const WATCH_KEY = 'investhub_watchlist_v1';
  let watchlist = JSON.parse(localStorage.getItem(WATCH_KEY)) || ['AAPL','TSLA','VTI'];

  // --- theme persistence ---
  const THEME_KEY = 'investhub_theme_v1';
  const savedTheme = localStorage.getItem(THEME_KEY) || 'dark';
  document.documentElement.setAttribute('data-theme', savedTheme);
  updateThemeIcon(savedTheme);

  /************************************************************************
   * Utilities
   ************************************************************************/
  function $ (sel, ctx=document) { return ctx.querySelector(sel); }
  function $$ (sel, ctx=document) { return Array.from(ctx.querySelectorAll(sel)); }
  function formatMoney(n) { return Number(n).toLocaleString(undefined, {maximumFractionDigits:0}); }
  function formatPrice(n) { return Number(n).toLocaleString(undefined, {minimumFractionDigits:2, maximumFractionDigits:2}); }

  /************************************************************************
   * Ticker Generation
   ************************************************************************/
  const topTickerSymbols = ['AAPL','TSLA','NVDA','MSFT','AMZN','GOOGL','META','SPY','QQQ','VTI'];
  function renderTicker() {
    const t1 = $('#tickerTrack');
    const t2 = $('#tickerTrackBottom');
    const items = topTickerSymbols.map(s => {
      const change = (Math.random()*4-1).toFixed(2);
      const up = change >= 0;
      return `<div class="ticker-item"><strong>${s}</strong> <span class="${up? 'stock-change-up':'stock-change-down'}">${up?'+':''}${change}%</span></div>`;
    }).join('');
    // duplicate to create long track for smooth scroll
    t1.innerHTML = items + items;
    t2.innerHTML = items + items;
  }
  renderTicker();

  /************************************************************************
   * Perf Chart (Chart.js)
   ************************************************************************/
  const perfCtx = document.getElementById('perfChart').getContext('2d');
  let perfChart;
  function initPerfChart(type='stocks') {
    const labels = type === 'stocks' ? ['AAPL','MSFT','GOOGL','TSLA','AMZN'] : ['VTI','SPY','QQQ','IVV','DIA'];
    const data = type === 'stocks' ? [2.1,1.8,1.2,3.5,2.9] : [1.1,0.9,1.7,0.8,1.3];
    if (perfChart) { perfChart.destroy(); }
    perfChart = new Chart(perfCtx, {
      type: 'bar',
      data: { labels, datasets: [{ label: 'Daily Performance (%)', data, backgroundColor:'rgba(236,201,6,0.5)', borderColor:'#ecc906dc', borderWidth:1 }] },
      options: {
        responsive:true,
        scales: {
          x: { ticks: { color: getComputedStyle(document.documentElement).getPropertyValue('--text-muted') || '#a0aec0' } },
          y: { ticks: { color: getComputedStyle(document.documentElement).getPropertyValue('--text-muted') || '#a0aec0' } }
        },
        plugins: { legend: { labels: { color: getComputedStyle(document.documentElement).getPropertyValue('--text-light') || '#f8f9fa' } } }
      }
    });
  }
  initPerfChart('stocks');
  $('#perfSelector').addEventListener('change', e => initPerfChart(e.target.value));
  $('#refreshPerf').addEventListener('click', () => initPerfChart($('#perfSelector').value));

  /************************************************************************
   * Render Stocks & ETFs as cards
   ************************************************************************/
  const stocksGrid = document.getElementById('stocksGrid');
  const etfsGrid = document.getElementById('etfsGrid');

  function renderStocks() {
    stocksGrid.innerHTML = '';
    initialStocks.forEach(s => {
      const col = document.createElement('div');
      col.className = 'col-md-6 col-lg-4 mb-4';
      col.innerHTML = `
        <div class="stock-card">
          <div class="d-flex justify-content-between align-items-start">
            <div class="d-flex align-items-center gap-3">
              <div class="stock-logo">${s.symbol[0]}</div>
              <div>
                <div class="fw-semibold">${s.name}</div>
                <div class="small muted">${s.exchange}</div>
              </div>
            </div>
            <div class="text-end">
              <div class="stock-price">$<span data-symbol="${s.symbol}">${formatPrice(s.price)}</span></div>
              <div class="small mt-1 stock-change ${Math.random()>0.5? 'stock-change-up':'stock-change-down'}"><i class="fa fa-arrow-up"></i> ${(Math.random()*4-1).toFixed(2)}%</div>
            </div>
          </div>
          <div class="mt-4 d-flex gap-2 flex-wrap">
            <button class="btn-gold buy-btn" data-symbol="${s.symbol}" data-price="${s.price}"><i class="fa fa-cart-plus"></i> Buy</button>
            <button class="btn-ghost sell-btn" data-symbol="${s.symbol}" data-price="${s.price}"><i class="fa fa-money-bill-wave"></i> Sell</button>
            <button class="btn-ghost ms-auto add-watch" data-symbol="${s.symbol}"><i class="fa fa-star"></i> Watch</button>
          </div>
        </div>
      `;
      // event listeners
      col.querySelector('.buy-btn').addEventListener('click', onBuyClick);
      col.querySelector('.sell-btn').addEventListener('click', onSellClick);
      col.querySelector('.add-watch').addEventListener('click', (ev) => {
        const sym = ev.currentTarget.dataset.symbol;
        addToWatchlist(sym);
      });
      stockCardHoverEffect(col.querySelector('.stock-card'));
      stocksGrid.appendChild(col);
    });
  }

  function renderETFs() {
    etfsGrid.innerHTML = '';
    initialETFs.forEach(e => {
      const col = document.createElement('div');
      col.className = 'col-md-6 col-lg-4 mb-4';
      col.innerHTML = `
        <div class="etf-card">
          <div class="d-flex align-items-center gap-4">
            <div class="etf-icon text-white rounded-lg d-flex align-items-center justify-content-center" style="width:64px;height:64px;background:linear-gradient(135deg,#00a3ff,#8b5cf6)"><i class="fa fa-chart-area"></i></div>
            <div>
              <div class="fw-semibold">${e.title}</div>
              <div class="small muted">${e.ticker}</div>
            </div>
          </div>
          <p class="mt-4 small muted">${e.title} — Expense: ${e.expense} • AUM: ${e.aum}</p>
          <div class="etf-stats mt-4 row text-center">
            <div class="col-6"><div class="fw-semibold">${e.ticker}</div><div class="small muted">Ticker</div></div>
            <div class="col-6"><div class="fw-semibold">${e.expense}</div><div class="small muted">Expense</div></div>
          </div>
        </div>
      `;
      etfsGrid.appendChild(col);
      // Add subtle 3d tilt on hover
      cardTiltEffect(col.querySelector('.etf-card'));
    });
  }

  // helper UI effects
  function stockCardHoverEffect(card) {
    card.addEventListener('mouseenter', () => {
      card.style.transform = 'translateY(-8px)';
      card.style.boxShadow = '0 20px 40px rgba(0,0,0,0.35)';
    });
    card.addEventListener('mouseleave', () => {
      card.style.transform = '';
      card.style.boxShadow = '';
    });
  }
  function cardTiltEffect(el) {
    el.addEventListener('mousemove', (ev) => {
      const r = el.getBoundingClientRect();
      const cx = r.left + r.width/2;
      const cy = r.top + r.height/2;
      const dx = (ev.clientX - cx)/r.width;
      const dy = (ev.clientY - cy)/r.height;
      el.style.transform = `perspective(900px) rotateX(${ -dy * 6 }deg) rotateY(${ dx * 6 }deg) translateY(-8px)`;
    });
    el.addEventListener('mouseleave', () => {
      el.style.transform = '';
    });
  }

  renderStocks();
  renderETFs();

  /************************************************************************
   * Watchlist (add/remove/persist)
   ************************************************************************/
  const watchlistContainer = document.getElementById('watchlistContainer');
  function renderWatchlist() {
    watchlistContainer.innerHTML = '';
    if (!watchlist || watchlist.length === 0) {
      watchlistContainer.innerHTML = '<div class="small muted text-center">No symbols in your watchlist — add one.</div>';
      return;
    }
    watchlist.forEach(sym => {
      const item = document.createElement('div');
      item.className = 'd-flex justify-content-between align-items-center card small p-3';
      // find latest price from initialStocks if exists, otherwise random
      const match = initialStocks.find(s=> s.symbol === sym);
      const price = match ? match.price : (100 + Math.random()*300).toFixed(2);
      const change = ((Math.random()*4)-1).toFixed(2);
      item.innerHTML = `
        <div class="d-flex align-items-center gap-3">
          <div class="stock-logo" style="width:44px;height:44px">${sym[0]}</div>
          <div>
            <div class="fw-semibold">${sym}</div>
            <div class="small muted">$${formatPrice(price)}</div>
          </div>
        </div>
        <div class="d-flex align-items-center gap-2">
          <div class="${change>=0 ? 'stock-change-up' : 'stock-change-down'} small">${change>=0?'+':''}${change}%</div>
          <button class="btn-ghost small view-symbol" data-symbol="${sym}">View</button>
          <button class="btn-ghost small remove-watch" data-symbol="${sym}">Remove</button>
        </div>
      `;
      item.querySelector('.remove-watch').addEventListener('click', (e) => {
        const s = e.currentTarget.dataset.symbol;
        watchlist = watchlist.filter(w => w !== s);
        localStorage.setItem(WATCH_KEY, JSON.stringify(watchlist));
        renderWatchlist();
      });
      item.querySelector('.view-symbol').addEventListener('click', (e) => {
        const s = e.currentTarget.dataset.symbol;
        // switch TradingView to symbol
        openTradingViewWithSymbol(s);
      });
      watchlistContainer.appendChild(item);
    });
  }
  renderWatchlist();

  // Add symbol UI
  $('#addSymbolBtn').addEventListener('click', () => {
    const val = $('#addSymbolInput').value.trim().toUpperCase();
    if (!val) return alert('Enter a symbol (e.g. AAPL)');
    addToWatchlist(val);
    $('#addSymbolInput').value = '';
  });
  $('#addSymbolInput').addEventListener('keyup', (e) => { if (e.key === 'Enter') $('#addSymbolBtn').click(); });

  function addToWatchlist(sym) {
    if (watchlist.includes(sym)) {
      toast(`${sym} already in watchlist`);
      return;
    }
    watchlist.unshift(sym);
    if (watchlist.length > 24) watchlist.pop();
    localStorage.setItem(WATCH_KEY, JSON.stringify(watchlist));
    renderWatchlist();
    toast(`${sym} added to watchlist`);
  }

  $('#clearWatch').addEventListener('click', () => {
    if (!confirm('Clear your watchlist?')) return;
    watchlist = [];
    localStorage.setItem(WATCH_KEY, JSON.stringify(watchlist));
    renderWatchlist();
  });

  /************************************************************************
   * Buy / Sell modal behavior
   ************************************************************************/
  const modalRoot = document.getElementById('modalRoot');

  function openModal(htmlContent) {
    modalRoot.innerHTML = `
      <div class="modal-bg" id="modalBg">
        <div class="modal">${htmlContent}</div>
      </div>`;
    modalRoot.style.display = 'block';
    // close on background click
    $('#modalBg').addEventListener('click', (e) => {
      if (e.target.id === 'modalBg') closeModal();
    });
  }

  function closeModal() {
    modalRoot.style.display = 'none';
    modalRoot.innerHTML = '';
  }

  function onBuyClick(e) {
    const sym = e.currentTarget.dataset.symbol;
    const price = Number(e.currentTarget.dataset.price);
    showTradeModal('Buy', sym, price);
  }
  function onSellClick(e) {
    const sym = e.currentTarget.dataset.symbol;
    const price = Number(e.currentTarget.dataset.price);
    showTradeModal('Sell', sym, price);
  }

  function showTradeModal(side, symbol, price) {
    const html = `
      <div class="d-flex justify-content-between align-items-center mb-4">
        <div><h3 class="fw-bold">${side} ${symbol}</h3><div class="small muted">Simulated trade</div></div>
        <div class="small muted">Market Price: $${formatPrice(price)}</div>
      </div>
      <div>
        <label class="small muted">Quantity</label>
        <input id="tradeQty" type="number" min="1" value="1" class="form-control bg-transparent border-secondary text-light mt-1" />
      </div>
      <div class="mt-4 d-flex gap-2">
        <button id="confirmTrade" class="btn-gold">${side}</button>
        <button id="cancelTrade" class="btn-ghost">Cancel</button>
      </div>
    `;
    openModal(html);
    $('#cancelTrade').addEventListener('click', closeModal);
    $('#confirmTrade').addEventListener('click', () => {
      const qty = Number($('#tradeQty').value);
      if (!qty || qty <= 0) return alert('Enter a valid quantity');
      // Simulate trade effect: update portfolio value
      const delta = (side === 'Buy' ? 1 : -1) * qty * price * 0.01; // tiny effect
      const pvEl = $('#portfolioValue');
      let pv = Number(pvEl.textContent.replace(/,/g,''));
      pv += delta;
      pvEl.textContent = Math.round(pv);
      toast(`${side} ${qty} ${symbol} @ $${formatPrice(price)} — simulated`);
      closeModal();
    });
  }

  function toast(msg, time=2300) {
    const t = document.createElement('div');
    t.className = 'position-fixed bottom-0 end-0 m-3 bg-dark text-white px-4 py-2 rounded shadow-lg z-50';
    t.textContent = msg;
    document.body.appendChild(t);
    setTimeout(()=> t.style.opacity = '0.01', time);
    setTimeout(()=> t.remove(), time+400);
  }

  /************************************************************************
   * TradingView integration (symbol selector + widget)
   ************************************************************************/
  let tvWidget = null;
  let currentTVSymbol = 'AAPL';

  function initTradingView(symbol='AAPL', interval='D', theme='dark') {
    // remove previous
    if (tvWidget) {
      try { tvWidget.remove(); } catch(e) {}
      document.getElementById('tvWidget').innerHTML = '';
    }
    currentTVSymbol = symbol;
    $('#tvCurrentSymbol').textContent = symbol;
    // TradingView widget config
    // allow_symbol_change: true -> adds symbol search in widget
    tvWidget = new TradingView.widget({
      autosize: true,
      symbol: symbol.startsWith('FOREX') ? symbol : 'NASDAQ:' + symbol, // default to NASDAQ if not prefixed
      interval: interval || 'D',
      timezone: 'Etc/UTC',
      theme: (document.documentElement.getAttribute('data-theme') === 'light') ? 'light' : 'dark',
      style: '1',
      locale: 'en',
      toolbar_bg: (document.documentElement.getAttribute('data-theme') === 'light') ? '#fff' : '#0b1220',
      enable_publishing: false,
      allow_symbol_change: true,
      container_id: 'tvWidget',
      // custom feature: when user changes symbol inside widget, we update tvCurrentSymbol
      overrides: {}
    });

    // There's no proper event callback from this anonymous widget for symbol change in public API,
    // but we will provide an external symbol search too to allow switching:
  }

  // show symbol search prompt (simple implementation)
  $('#openSymbolSearch').addEventListener('click', () => {
    const s = prompt('Enter a symbol to view (e.g. AAPL, MSFT, SPY):', currentTVSymbol || 'AAPL');
    if (s) openTradingViewWithSymbol(s.trim().toUpperCase());
  });

  function openTradingViewWithSymbol(sym) {
    const chosen = sym;
    // Attempt to map to exchange: if it matches major ones keep as-is
    // We'll let TradingView resolve the symbol. Use "NASDAQ:" prefix by default.
    initTradingView(chosen, $('#tvInterval').value);
  }

  // init with default
  initTradingView('AAPL', 'D', savedTheme);

  // change interval
  $('#tvInterval').addEventListener('change', (e) => {
    initTradingView(currentTVSymbol, e.target.value);
  });

  /************************************************************************
   * Simulated price updates for stock cards (and reflect on watchlist)
   ************************************************************************/
  function simulatePriceFluctuations() {
    // Update each displayed stock price randomly
    $$('.stock-price span').forEach(span => {
      const sym = span.dataset.symbol;
      let base = initialStocks.find(s => s.symbol === sym)?.price || (100 + Math.random()*200);
      // small random drift
      const changePct = (Math.random()*2 - 1) * 0.02; // +/-2%
      base = base * (1 + changePct);
      span.textContent = formatPrice(base);
    });
  }
  setInterval(simulatePriceFluctuations, 8000);

  /************************************************************************
   * Light/Dark Toggle
   ************************************************************************/
  $('#themeToggle').addEventListener('click', () => {
    const current = document.documentElement.getAttribute('data-theme') || 'dark';
    const next = current === 'dark' ? 'light' : 'dark';
    document.documentElement.setAttribute('data-theme', next);
    localStorage.setItem(THEME_KEY, next);
    updateThemeIcon(next);
    // re-init tradingview to apply theme
    initTradingView(currentTVSymbol, $('#tvInterval').value, next);
  });

  function updateThemeIcon(theme) {
    const t = $('#themeToggle');
    if (!t) return;
    t.innerHTML = theme === 'dark' ? '<i class="fa fa-sun"></i> Light' : '<i class="fa fa-moon"></i> Dark';
  }

  /************************************************************************
   * Init & GSAP Animations
   ************************************************************************/
  document.addEventListener('DOMContentLoaded', () => {
    // animate hero content
    gsap.from('.hero .btn-gold', { y: -18, opacity:0, duration: 0.8 });
    gsap.from('.hero h1', { y: 30, opacity:0, duration: 1, delay: 0.2 });
    gsap.from('.hero p', { y: 10, opacity:0, duration: 0.8, delay: 0.4 });

    // fade-in cards
    gsap.utils.toArray('.card, .stock-card, .etf-card, .tool-card').forEach((el, i) => {
      gsap.from(el, { y: 40, opacity:0, duration: 0.9, delay: 0.08 * i, ease: 'power2.out' });
    });
  });

  /************************************************************************
   * Buttons: CTA & Demo
   ************************************************************************/
  $('#startTradeBtn').addEventListener('click', () => {
    // show a friendly modal to create account or start demo
    openModal(`
      <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
          <h3 class="fw-bold">Start Trading</h3>
          <div class="small muted">Create a free demo account</div>
        </div>
      </div>
      <div class="mb-3">
        <label class="small muted">Email</label>
        <input id="signupEmail" type="email" class="form-control bg-transparent border-secondary text-light mt-1" placeholder="you@example.com" />
      </div>
      <div class="d-flex gap-2 mt-3">
        <button id="createAccount" class="btn-gold">Create Demo Account</button>
        <button id="cancelCreate" class="btn-ghost">Cancel</button>
      </div>
    `);
    $('#cancelCreate').addEventListener('click', closeModal);
    $('#createAccount').addEventListener('click', () => {
      const email = $('#signupEmail').value.trim();
      if (!email) return alert('Please enter an email');
      toast('Demo account created — welcome!');
      closeModal();
    });
  });

  $('#demoBtn').addEventListener('click', () => {
    openModal(`<div><h3 class="fw-bold">Schedule a Demo</h3><p class="small muted">Our team will reach out.</p><div class="mt-3"><button id="closeDemo" class="btn-gold">OK</button></div></div>`);
    $('#closeDemo').addEventListener('click', closeModal);
  });

  $('#ctaCreate').addEventListener('click', () => { $('#startTradeBtn').click(); });
  $('#ctaDemo').addEventListener('click', () => { $('#demoBtn').click(); });

  /************************************************************************
   * View symbol in TradingView when clicking watchlist items etc
   ************************************************************************/
  function ensureValidSymbolForTV(sym) {
    // Basic heuristic: if symbol contains ':' return as-is, else prefix NASDAQ:
    if (sym.includes(':')) return sym;
    // common ETFs/tickers
    const upper = sym.toUpperCase();
    const knownExchanges = ['NYSE','NASDAQ','AMEX'];
    // We'll default to NASDAQ prefix for common tickers (user can search inside widget)
    return upper;
  }

  /************************************************************************
   * Misc: update UI always reflect watchlist & stocks
   ************************************************************************/
  // render dynamic components on load
  renderWatchlist();

  // update tv symbol display when widget changed (we recreate widget whenever we call initTradingView)
  // helper: openTradingViewWithSymbol is already defined

  // Simple periodic refresh of perf chart to make it feel alive
  setInterval(() => {
    // nudge perf chart dataset values
    if (perfChart) {
      perfChart.data.datasets[0].data = perfChart.data.datasets[0].data.map(v => +(v * (1 + ((Math.random()*2-1)/100))).toFixed(2));
      perfChart.update();
    }
  }, 10000);

  // Simulate updating the top summary numbers
  setInterval(() => {
    const randCap = Math.round(43200000000000 * (0.98 + Math.random()*0.04));
    $('#globalCap').textContent = formatMoney(randCap);
    const randVol = Math.round(298000000000 * (0.98 + Math.random()*0.08));
    $('#vol').textContent = formatMoney(randVol);
  }, 9000);

  /************************************************************************
   * Small UX helpers
   ************************************************************************/
  // allow clicking on stock-card body to open a view modal
  document.addEventListener('click', (e) => {
    if (e.target.closest('.stock-card') && !e.target.closest('button')) {
      const card = e.target.closest('.stock-card');
      const symbol = card.querySelector('[data-symbol]')?.dataset.symbol || card.querySelector('.stock-logo')?.textContent.trim();
      const price = card.querySelector('.stock-price span')?.textContent || '0.00';
      openModal(`<div><h3 class="fw-bold">${symbol} — Details</h3><p class="small muted">Price: $${price}</p><div class="mt-3 d-flex gap-2"><button class="btn-gold" id="modalBuy">Buy</button><button class="btn-ghost" id="modalSell">Sell</button><button class="btn-ghost" id="modalWatch">Watch</button></div></div>`);
      $('#modalBuy').addEventListener('click', () => { closeModal(); showTradeModal('Buy', symbol, parseFloat(price)); });
      $('#modalSell').addEventListener('click', () => { closeModal(); showTradeModal('Sell', symbol, parseFloat(price)); });
      $('#modalWatch').addEventListener('click', () => { addToWatchlist(symbol); closeModal(); });
    }
  });

  // initial render of top-level dynamic items in stocks grid is already done
  // ensure watchlist UI is visible
  renderWatchlist();

  // sound finish
  console.log('Stocks & ETFs page ready — interactive TradingView, watchlist, buy/sell modals, chart, ticker.');

  </script>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="/js/app.js"></script>
</body>
</html>